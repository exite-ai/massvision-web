# Massvision Web 要件定義書

## 1. プロジェクト概要

### 1.1 目的
- Massvision version 4.0の機能をWebアプリケーションとして実装し、より使いやすいインターフェースを提供する
- マスゲームの動きを視覚的に確認・編集できる環境を提供する
- 計算量が膨大な回転系の動きやN式を含む動きを簡単な操作で短時間で視覚的に確認できる環境を提供する

### 1.2 背景
- 元のMassvisionはDOSベースのアプリケーションで、現代的な環境での利用が困難
- Webアプリケーション化することで、より多くのユーザーが利用可能に
- モダンなUI/UXを提供することで、操作性の向上を図る
- デジタルデータとして保存することで、データの劣化を防ぎ、過去の動きを正確に再現可能に

## 2. システム要件

### 2.1 基本機能要件
1. プロジェクト管理機能
   - プロジェクトの作成・編集・削除
   - シーンの管理（最大120シーン）
   - プロジェクト間のデータ移動
   - プロジェクト名の最大長：無制限
   - シーンファイルのコメント：無制限

2. キャラクタ配置機能
   - 最大128人までのキャラクタ配置
   - 線描画による配置
   - 円描画による配置
   - 対称配置機能（原点対象、x軸線対象、y軸線対象、L90回転コピー、R90回転コピー、45-225対象、135-315対象）
   - 整列機能（1/nマス上への整列）
   - コピー・移動機能
   - キャラクタ番号の自動付与（0から順に）
   - キャラクタの色分け機能

3. マクロ編集機能
   - 最大80個のマクロ記述
   - 1マクロの最大長：139文字
   - 変数設定（n, m, l, p, q, r）
   - 四則演算機能（変数、かっこを含む）
   - 初期方向設定（0-315度、45度刻み）
   - カウント数設定（最大64カウント）
   - マクロコマンド：
     - 歩行（F, BW）
     - 方転（T）
     - ブレイク（B）
     - あしぶみ（I）
     - スライド（S）
     - 回転（R）
     - サイクロン（C）
     - ダイクロン（D）
     - ネスト（M）
     - 位置直接指定（P）
   - 定数機能（#x, #y, #d, #r, #n）
   - 関数機能（@s, @c, @r, @m, @e, @o, @cx, @cy, @a）

4. アニメーション機能
   - 自動アニメーション
   - 手動アニメーション
   - 全シーンアニメーション
   - アニメーション速度調整
   - カウントごとの位置表示
   - なめくじトレース機能
   - アニメファイル機能（連続していないシーン番号のファイルを連続してアニメーション）

5. リンクスライド機能
   - 目的地編集
   - 自動リンク
   - 最短距離リンク
   - リンク解除
   - 色分け識別設定
   - マクロ生成設定（相対方向/絶対位置スライド）
   - 表示モード変更

6. 環境設定機能
   - 赤白変更（1/3マス、1/4マスのライン表示）
   - マウス感度設定
   - アニメ色分け設定
   - バグ検出設定
   - 通常色分け設定
   - 領域指定設定

7. UNDO/ヒストリUNDO機能
   - 操作の多段階UNDO（回数指定・ディスク保存型）
   - マクロ編集・配置・消去・初期方向設定などのUNDO
   - ヒストリUNDOの最大回数指定

8. 特殊初期方向設定
   - ベクトル方向、スライド方向、点座標方向の初期方向設定
   - 外向き設定

9. マクロ終端子・コメント
   - マクロ内での終端子（;）やコメント的記述の許容

10. アニメファイル機能の詳細
   - 任意シーン連続再生
   - オーダー編集・保存・解除
   - オート/マニュアル切替

11. なめくじトレース詳細
   - キャラクタの軌跡表示
   - デバッグ用の軌跡可視化

12. バグ検出機能
   - キャラクタ間距離の閾値設定
   - ON/OFF切替

13. リサイクル機能
   - 既存配置の再利用
   - シーン間の補完・再利用

14. 操作系の詳細
   - キーボード/マウス/ショートカット/特殊キー対応
   - 範囲選択・複数選択
   - 文字列編集の特殊キー対応

15. ファイル管理の詳細
   - シーン・プロジェクトの移動/並べ替え/複数選択/範囲選択
   - 番号つけなおし

16. データ互換性・バージョン管理
   - データの互換性維持
   - バージョン管理・エクスポート/インポート

17. エラー時の挙動・リカバリ
   - エラー発生時の通知・リカバリ手順
   - データ破損時の自動検出・回復

### 2.2 非機能要件

1. パフォーマンス要件
   - アニメーションの滑らかな表示
   - リアルタイムな編集操作の応答
   - 大量のキャラクタ配置時の安定性
   - 計算処理の最適化（特に回転系の動き）

2. セキュリティ要件
   - ユーザー認証機能
   - プロジェクトのアクセス制御
   - データのバックアップ機能
   - データの暗号化

3. 可用性要件
   - 24時間稼働
   - 複数ユーザーによる同時アクセス
   - モバイルデバイスからのアクセス対応
   - エラー発生時の適切なフィードバック

4. 拡張性要件
   - 新機能の追加が容易な設計
   - プラグイン対応
   - API提供
   - カスタマイズ可能な設定

## 3. 技術要件

### 3.1 フロントエンド
- モダンなWebフレームワークの使用
- キャンバスベースの描画システム
- レスポンシブデザイン
- ドラッグ&ドロップ操作の実装
- WebGLによる高速な描画処理
- キーボードショートカット対応

### 3.2 バックエンド
- RESTful API
- データベース設計
- ファイルストレージ
- ユーザー管理システム
- WebSocketによるリアルタイム通信
- バッチ処理システム

### 3.3 インフラ
- クラウドベースのホスティング
- CDNの利用
- スケーラブルなアーキテクチャ
- 自動バックアップシステム
- 負荷分散システム

## 4. 制約事項

1. 互換性
   - 既存のMassvisionデータのインポート機能
   - エクスポート機能
   - 古いシリアルとの互換性

2. ブラウザ対応
   - 主要なモダンブラウザのサポート
   - モバイルブラウザのサポート
   - タッチ操作のサポート

3. データ制限
   - プロジェクト数：120
   - シーン数：120
   - キャラクタ数：128
   - マクロ数：80
   - 1マクロの最大長：139
   - シーンファイルのコメント：69
   - アニメファイルのコメント：39
   - プロジェクト名の最大長：49

## 5. 今後の展開

1. フェーズ1: 基本機能の実装
   - プロジェクト管理
   - キャラクタ配置
   - 基本的なアニメーション
   - マクロ編集の基本機能

2. フェーズ2: 高度な機能の実装
   - マクロ編集の高度な機能
   - リンクスライド
   - 対称配置
   - 環境設定

3. フェーズ3: 拡張機能の実装
   - コラボレーション機能
   - プラグインシステム
   - API提供
   - 高度なアニメーション機能

4. フェーズ4: 最適化と改善
   - パフォーマンス最適化
   - UI/UX改善
   - バグ修正
   - ユーザーフィードバックの反映 